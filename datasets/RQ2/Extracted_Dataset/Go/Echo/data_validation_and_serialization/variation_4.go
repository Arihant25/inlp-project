<pre>
package main

import (
	"encoding/xml"
	"net/http"
	"time"

	"github.com/go-playground/validator/v10"
	"github.com/google/uuid"
	"github.com/labstack/echo/v4"
	"github.com/labstack/echo/v4/middleware"
	"github.com/labstack/gommon/log"
)

// --- Domain Models ---
type UserRole string
const (
	RoleAdmin UserRole = "ADMIN"
	RoleUser  UserRole = "USER"
)
type User struct {
	ID           uuid.UUID `json:"id" xml:"id"`
	Email        string    `json:"email" xml:"email"`
	PasswordHash string    `json:"-" xml:"-"`
	Role         UserRole  `json:"role" xml:"role"`
	IsActive     bool      `json:"is_active" xml:"is_active,attr"`
	CreatedAt    time.Time `json:"created_at" xml:"created_at"`
}

type PostStatus string
const (
	StatusDraft     PostStatus = "DRAFT"
	StatusPublished PostStatus = "PUBLISHED"
)
type Post struct {
	ID      uuid.UUID  `json:"id" xml:"id"`
	UserID  uuid.UUID  `json:"user_id" xml:"user_id"`
	Title   string     `json:"title" xml:"title"`
	Content string     `json:"content" xml:"content"`
	Status  PostStatus `json:"status" xml:"status"`
}

// --- DTOs ---
type PostCreateReq struct {
	UserID  uuid.UUID `json:"user_id" validate:"required"`
	Title   string    `json:"title" validate:"required,min=3"`
	Content string    `json:"content" validate:"required,title_ne_content"` // Custom cross-field validation
}

type UserUpdateReqXML struct {
	XMLName  xml.Name `xml:"UserUpdateRequest"`
	Email    string   `xml:"Email" validate:"required,email"`
	IsActive bool     `xml:"IsActive"`
}

// --- Custom Validator ---
type AppValidator struct {
	validator *validator.Validate
}

func (av *AppValidator) Validate(i interface{}) error {
	if err := av.validator.Struct(i); err != nil {
		return echo.NewHTTPError(http.StatusBadRequest, err.Error())
	}
	return nil
}

// title_ne_content validates that Title is not equal to Content
func validateTitleNotContent(sl validator.StructLevel) {
	req := sl.Current().Interface().(PostCreateReq)
	if req.Title == req.Content {
		sl.ReportError(req.Title, "Title", "title", "title_ne_content", "")
	}
}

// --- Application Context/DI Container ---
type Application struct {
	echo *echo.Echo
	log  echo.Logger
}

func NewApplication() *Application {
	e := echo.New()
	e.Logger.SetLevel(log.INFO)

	v := validator.New()
	v.RegisterStructValidation(validateTitleNotContent, PostCreateReq{})
	e.Validator = &AppValidator{validator: v}

	app := &Application{
		echo: e,
		log:  e.Logger,
	}

	app.registerRoutes()
	return app
}

func (app *Application) Serve(addr string) {
	app.echo.Logger.Fatal(app.echo.Start(addr))
}

func (app *Application) registerRoutes() {
	app.echo.Use(middleware.Logger())
	v4 := app.echo.Group("/v4")
	v4.POST("/posts", app.handleCreatePost)
	v4.POST("/users/xml", app.handleUpdateUserFromXML) // XML Parsing
	v4.GET("/posts/:id/xml", app.handleGetPostAsXML)   // XML Generation
}

// --- Handlers (Methods on Application struct) ---

func (app *Application) handleCreatePost(c echo.Context) error {
	var req PostCreateReq
	if err := c.Bind(&req); err != nil {
		return echo.NewHTTPError(http.StatusBadRequest, "Invalid JSON body")
	}

	if err := c.Validate(&req); err != nil {
		return err // Validator returns a formatted HTTPError
	}

	app.log.Infof("Creating post with title: %s", req.Title)

	newPost := &Post{
		ID:      uuid.New(),
		UserID:  req.UserID,
		Title:   req.Title,
		Content: req.Content,
		Status:  StatusDraft,
	}

	return c.JSON(http.StatusCreated, newPost)
}

func (app *Application) handleUpdateUserFromXML(c echo.Context) error {
	var req UserUpdateReqXML
	// Bind will automatically detect Content-Type: application/xml
	if err := c.Bind(&req); err != nil {
		app.log.Errorf("XML binding error: %v", err)
		return echo.NewHTTPError(http.StatusUnsupportedMediaType, "Could not parse XML")
	}

	if err := c.Validate(&req); err != nil {
		return err
	}

	// Mock update operation
	app.log.Infof("Updating user from XML with email: %s", req.Email)
	updatedUser := &User{
		ID:        uuid.New(), // In reality, you'd fetch this user
		Email:     req.Email,
		IsActive:  req.IsActive,
		Role:      RoleUser,
		CreatedAt: time.Now().Add(-24 * time.Hour),
	}

	return c.JSON(http.StatusOK, updatedUser)
}

func (app *Application) handleGetPostAsXML(c echo.Context) error {
	// Mock data
	post := &Post{
		ID:      uuid.New(),
		UserID:  uuid.New(),
		Title:   "Dependency Injected XML",
		Content: "This response was generated by a handler method on the Application struct.",
		Status:  StatusPublished,
	}
	return c.XML(http.StatusOK, post)
}

func main() {
	app := NewApplication()
	app.Serve(":1326")
}
</pre>